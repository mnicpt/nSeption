/**
 * Creates events for back, forward and close events on the browser
 * 
 * author		: Steve Mask (pk4y)
 * version		: 1.0
 * date			: May 27, 2013
 * 
 * dependency	: history.js
 * 
 */(function(e,t){var n=!1,r=!1,i=!1,s=!1,o=typeof history.state=="object"?"popstate":"hashchange",u=navigator.userAgent.indexOf("Firefox")!==-1,a=navigator.userAgent.indexOf("iPhone")!==-1,f=navigator.userAgent.indexOf("iPad")!==-1,l=a||f,c=function(){n=!0;r=!1;s=!1};e(document).on("click","a",function(n){var r=e(n.target),s=r.attr("href");if(s!==undefined&&s.indexOf("#")<0&&s.indexOf("javascript")===-1){i=!0;t.pushState({state:"forward"},null)}});e(document).on("submit","form",function(){i=!0;t.pushState({state:"forward"},null)});e(window).on("pageshow",function(e){e.persisted&&location.reload(!0)});e(window).on("pagehide",function(){r});e(window).on("beforeunload",function(){if(!s()&&i===!1&&n===!1){r=!0;return"Are you sure you want to refresh or close the page?"}});e(window).load(function(){c();if(t.state()===null||t.state().state===""){i=!0;t.replaceState({state:"back"},null);t.pushState({state:"page"},null);(u||l)&&e(window).trigger(jQuery.Event("popstate"))}else t.state().state==="back"?t.forward():t.state().state==="forward"&&t.back()});e(window).on(o,function(){if(t.state()!==null){if(t.state().state==="")t.back();else if(!i&&!n)if(t.state().state==="back"){e(document).trigger(jQuery.Event("back"));s=!0;t.back()}else if(t.state().state==="forward"){e(document).trigger(jQuery.Event("forward"));s=!0;t.forward()}i=!1;n=!1;e(".console").append("<br /><br />state: "+t.state().state+"<br />previous page: "+t.previousPage()+"<br />current page: "+t.currentPage+"<br />next page: "+t.nextPage()+"<br />history: "+localStorage.history)}})})(jQuery,History);